javascript:function(){if(window.accessibilityContrastChecker)return void window.accessibilityContrastChecker.toggle();const t={hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},rgbToHex:(t,e,n)=>"#"+((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1),rgbToHsl(t,e,n){t/=255,e/=255,n/=255;const o=Math.max(t,e,n),a=Math.min(t,e,n);let r,s,i=(o+a)/2;if(o===a)r=s=0;else{const c=o-a;switch(s=i>.5?c/(2-o-a):c/(o+a),o){case t:r=(e-n)/c+(e<n?6:0);break;case e:r=(n-t)/c+2;break;case n:r=(t-e)/c+4}r/=6}return{h:360*r,s:100*s,l:100*i}},rgbToHsv(t,e,n){t/=255,e/=255,n/=255;const o=Math.max(t,e,n),a=Math.min(t,e,n);let r,s,i=o;const c=o-a;if(s=0===o?0:c/o,o===a)r=0;else{switch(o){case t:r=(e-n)/c+(e<n?6:0);break;case e:r=(n-t)/c+2;break;case n:r=(t-e)/c+4}r/=6}return{h:360*r,s:100*s,v:100*i}},parseColor(t){if(!t||"transparent"===t)return null;try{const e=document.createElement("canvas");e.width=e.height=1;const n=e.getContext("2d");n.fillStyle=t,n.fillRect(0,0,1,1);const o=n.getImageData(0,0,1,1).data;return{r:o[0],g:o[1],b:o[2],a:o[3]/255}}catch(e){return console.warn("Could not parse color:",t),null}},getLuminance(t,e,n){const o=t/255,a=e/255,r=n/255;return.2126*(o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))+.7152*(a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))},getContrast(t,e){const n=this.getLuminance(t.r,t.g,t.b),o=this.getLuminance(e.r,e.g,e.b);return(Math.max(n,o)+.05)/(Math.min(n,o)+.05)},simulateColorBlindness(t,e,n,o){const a={protanopia:[[.567,.433,0],[.558,.442,0],[0,.242,.758]],deuteranopia:[[.625,.375,0],[.7,.3,0],[0,.3,.7]],tritanopia:[[.95,.05,0],[0,.433,.567],[0,.475,.525]]}[o];return a?{r:Math.round(Math.max(0,Math.min(255,t*a[0][0]+e*a[0][1]+n*a[0][2]))),g:Math.round(Math.max(0,Math.min(255,t*a[1][0]+e*a[1][1]+n*a[1][2]))),b:Math.round(Math.max(0,Math.min(255,t*a[2][0]+e*a[2][1]+n*a[2][2])))}:{r:t,g:e,b:n}}};window.accessibilityContrastChecker=new class{constructor(){this.isVisible=!1,this.hoverMode=!1,this.boxSelectMode=!1,this.isSelecting=!1,this.issues=[],this.highlightedElements=[],this.colorPalettes=this.loadPalettes(),this.currentColorFormat="hex",this.observer=null,this.tooltip=null,this.hoverHandler=null,this.mouseLeaveHandler=null,this.boxStartHandler=null,this.boxMoveHandler=null,this.boxEndHandler=null,this.init()}init(){this.createUI(),this.setupEventListeners(),this.setupMutationObserver()}loadPalettes(){try{const t=localStorage.getItem("acc-contrast-palettes");return t?JSON.parse(t):{}}catch(t){return{}}}savePalettes(){try{localStorage.setItem("acc-contrast-palettes",JSON.stringify(this.colorPalettes))}catch(t){console.warn("Could not save palettes to localStorage")}}createUI(){const t=document.getElementById("acc-contrast-overlay");t&&t.remove(),this.overlay=document.createElement("div"),this.overlay.id="acc-contrast-overlay",this.overlay.innerHTML='\n<div class="acc-header">\n<h3>Accessibility Contrast Checker</h3>\n<div class="acc-controls">\n<button id="acc-minimize">‚àí</button>\n<button id="acc-close">√ó</button>\n</div>\n</div>\n<div class="acc-content">\n<div class="acc-tabs">\n<button class="acc-tab active" data-tab="checker">Checker</button>\n<button class="acc-tab" data-tab="results">Results</button>\n<button class="acc-tab" data-tab="settings">Settings</button>\n</div>\n\n<div class="acc-tab-content active" id="acc-checker">\n<div class="acc-section">\n<h4>Color Picker</h4>\n<div class="acc-color-inputs">\n<div class="acc-color-group">\n<label>Foreground:</label>\n<input type="color" id="acc-fg-color" value="#000000">\n<input type="text" id="acc-fg-text" value="#000000">\n</div>\n<div class="acc-color-group">\n<label>Background:</label>\n<input type="color" id="acc-bg-color" value="#ffffff">\n<input type="text" id="acc-bg-text" value="#ffffff">\n</div>\n</div>\n<div class="acc-format-selector">\n<select id="acc-color-format">\n<option value="hex">HEX</option>\n<option value="rgb">RGB</option>\n<option value="hsl">HSL</option>\n<option value="hsv">HSV</option>\n</select>\n</div>\n<div class="acc-contrast-result">\n<div id="acc-contrast-ratio">Contrast: 21.00:1</div>\n<div id="acc-wcag-status">‚úÖ WCAG AA Pass</div>\n</div>\n</div>\n\n<div class="acc-section">\n<h4>Analysis Tools</h4>\n<div class="acc-buttons">\n<button id="acc-scan-all">üîç Scan All Elements</button>\n<button id="acc-hover-mode">üëÜ Hover Mode</button>\n<button id="acc-box-select">üì¶ Box Select</button>\n<button id="acc-clear-highlights">üßπ Clear Highlights</button>\n</div>\n</div>\n\n<div class="acc-section">\n<h4>Color Adjustment</h4>\n<div class="acc-sliders">\n<div class="acc-slider-group">\n<label>Lighten/Darken Text:</label>\n<input type="range" id="acc-text-adjust" min="-100" max="100" value="0">\n<span id="acc-text-value">0</span>\n</div>\n<div class="acc-slider-group">\n<label>Lighten/Darken Background:</label>\n<input type="range" id="acc-bg-adjust" min="-100" max="100" value="0">\n<span id="acc-bg-value">0</span>\n</div>\n</div>\n</div>\n</div>\n\n<div class="acc-tab-content" id="acc-results">\n<div class="acc-section">\n<h4>Issues Found</h4>\n<div class="acc-issue-filters">\n<button class="acc-filter active" data-filter="all">All</button>\n<button class="acc-filter" data-filter="1.4.3">1.4.3 Text</button>\n<button class="acc-filter" data-filter="1.4.11">1.4.11 Non-text</button>\n</div>\n<div id="acc-issues-list"></div>\n</div>\n</div>\n\n<div class="acc-tab-content" id="acc-settings">\n<div class="acc-section">\n<h4>Color Blindness Simulation</h4>\n<select id="acc-colorblind-sim">\n<option value="none">None</option>\n<option value="protanopia">Protanopia</option>\n<option value="deuteranopia">Deuteranopia</option>\n<option value="tritanopia">Tritanopia</option>\n</select>\n</div>\n\n<div class="acc-section">\n<h4>Color Palettes</h4>\n<div class="acc-palette-controls">\n<input type="text" id="acc-palette-name" placeholder="Palette name">\n<button id="acc-save-palette">Save Current Colors</button>\n</div>\n<div id="acc-saved-palettes"></div>\n</div>\n</div>\n</div>\n';const e=document.createElement("style");e.textContent='\n#acc-contrast-overlay {\nposition: fixed;\ntop: 20px;\nright: 20px;\nwidth: 350px;\nmax-height: 80vh;\nbackground: #fff;\nborder: 2px solid #333;\nborder-radius: 8px;\nbox-shadow: 0 4px 20px rgba(0,0,0,0.3);\nz-index: 999999;\nfont-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;\nfont-size: 14px;\noverflow: hidden;\ncursor: move;\n}\n\n.acc-header {\nbackground: #333;\ncolor: #FFFFFF;\npadding: 10px;\ndisplay: flex;\njustify-content: space-between;\nalign-items: center;\ncursor: move;\n}\n\n.acc-header h3 {\nmargin: 0;\nfont-size: 16px;\ncolor: #FFFFFF;\n}\n\n.acc-controls button {\nbackground: none;\nborder: none;\ncolor: white;\nfont-size: 18px;\ncursor: pointer;\nmargin-left: 5px;\npadding: 0 5px;\n}\n\n.acc-controls button:hover {\nbackground: rgba(255, 255, 255, 0.2);\nborder-radius: 3px;\n}\n\n.acc-content {\nmax-height: 70vh;\noverflow-y: auto;\n}\n\n.acc-tabs {\ndisplay: flex;\nbackground: #f5f5f5;\nborder-bottom: 1px solid #ddd;\n}\n\n.acc-tab {\nflex: 1;\npadding: 10px;\nborder: none;\nbackground: none;\ncursor: pointer;\nborder-bottom: 2px solid transparent;\n}\n\n.acc-tab.active {\nbackground: white;\nborder-bottom-color: #007cba;\n}\n\n.acc-tab-content {\ndisplay: none;\npadding: 15px;\n}\n\n.acc-tab-content.active {\ndisplay: block;\n}\n\n.acc-section {\nmargin-bottom: 20px;\n}\n\n.acc-section h4 {\nmargin: 0 0 10px 0;\ncolor: #333;\nfont-size: 14px;\nfont-weight: 600;\n}\n\n.acc-color-inputs {\ndisplay: flex;\nflex-direction: column;\ngap: 10px;\n}\n\n.acc-color-group {\ndisplay: flex;\nalign-items: center;\ngap: 10px;\n}\n\n.acc-color-group label {\nwidth: 80px;\nfont-weight: 500;\n}\n\n.acc-color-group input[type="color"] {\nwidth: 40px;\nheight: 30px;\nborder: none;\nborder-radius: 4px;\ncursor: pointer;\n}\n\n.acc-color-group input[type="text"] {\nflex: 1;\npadding: 5px;\nborder: 1px solid #ddd;\nborder-radius: 4px;\nfont-family: monospace;\n}\n\n.acc-format-selector {\nmargin: 10px 0;\n}\n\n.acc-format-selector select {\npadding: 5px;\nborder: 1px solid #ddd;\nborder-radius: 4px;\nwidth: 100%;\n}\n\n.acc-contrast-result {\nbackground: #f8f9fa;\npadding: 15px;\nborder-radius: 6px;\ntext-align: center;\nmargin: 10px 0;\n}\n\n#acc-contrast-ratio {\nfont-size: 20px;\nfont-weight: bold;\nmargin-bottom: 5px;\n}\n\n#acc-wcag-status {\nfont-size: 14px;\n}\n\n.acc-buttons {\ndisplay: grid;\ngrid-template-columns: 1fr 1fr;\ngap: 8px;\n}\n\n.acc-buttons button {\npadding: 8px 12px;\nborder: 1px solid #ddd;\nborder-radius: 4px;\nbackground: white;\ncursor: pointer;\nfont-size: 12px;\n}\n\n.acc-buttons button:hover {\nbackground: #f0f0f0;\n}\n\n.acc-buttons button.active {\nbackground: #007cba;\ncolor: white;\nborder-color: #007cba;\n}\n\n.acc-sliders {\ndisplay: flex;\nflex-direction: column;\ngap: 15px;\n}\n\n.acc-slider-group {\ndisplay: flex;\nflex-direction: column;\ngap: 5px;\n}\n\n.acc-slider-group label {\nfont-size: 12px;\nfont-weight: 500;\ndisplay: flex;\njustify-content: space-between;\nalign-items: center;\n}\n\n.acc-slider-group input[type="range"] {\nwidth: 100%;\n}\n\n.acc-issue-filters {\ndisplay: flex;\ngap: 5px;\nmargin-bottom: 15px;\n}\n\n.acc-filter {\npadding: 5px 10px;\nborder: 1px solid #ddd;\nborder-radius: 4px;\nbackground: white;\ncursor: pointer;\nfont-size: 12px;\n}\n\n.acc-filter.active {\nbackground: #007cba;\ncolor: white;\nborder-color: #007cba;\n}\n\n#acc-issues-list {\nmax-height: 300px;\noverflow-y: auto;\n}\n\n.acc-issue-item {\npadding: 10px;\nborder: 1px solid #ddd;\nborder-radius: 4px;\nmargin-bottom: 10px;\ncursor: pointer;\nbackground: white;\n}\n\n.acc-issue-item:hover {\nbackground: #f8f9fa;\n}\n\n.acc-issue-header {\nfont-weight: bold;\nmargin-bottom: 5px;\n}\n\n.acc-issue-details {\nfont-size: 12px;\ncolor: #666;\n}\n\n.acc-issue-details button {\nmargin-top: 5px;\nmargin-right: 5px;\npadding: 2px 6px;\nfont-size: 11px;\nborder: 1px solid #ddd;\nbackground: white;\ncursor: pointer;\nborder-radius: 3px;\n}\n\n.acc-issue-details button:hover {\nbackground: #f0f0f0;\n}\n\n.acc-palette-controls {\ndisplay: flex;\ngap: 10px;\nmargin-bottom: 15px;\n}\n\n.acc-palette-controls input {\nflex: 1;\npadding: 5px;\nborder: 1px solid #ddd;\nborder-radius: 4px;\n}\n\n.acc-palette-controls button {\npadding: 5px 10px;\nborder: 1px solid #ddd;\nborder-radius: 4px;\nbackground: white;\ncursor: pointer;\nfont-size: 12px;\n}\n\n.acc-palette-item {\ndisplay: flex;\nalign-items: center;\njustify-content: space-between;\npadding: 8px;\nborder: 1px solid #ddd;\nborder-radius: 4px;\nmargin-bottom: 5px;\n}\n\n.acc-palette-colors {\ndisplay: flex;\ngap: 5px;\nmargin-top: 5px;\n}\n\n.acc-palette-color {\nwidth: 20px;\nheight: 20px;\nborder-radius: 50%;\nborder: 1px solid #ddd;\n}\n\n.acc-palette-item button {\npadding: 2px 6px;\nfont-size: 11px;\nmargin-left: 5px;\nborder: 1px solid #ddd;\nbackground: white;\ncursor: pointer;\nborder-radius: 3px;\n}\n\n.acc-highlight-pass {\noutline: 2px solid #28a745 !important;\noutline-offset: 2px !important;\n}\n\n.acc-highlight-fail {\noutline: 2px solid #dc3545 !important;\noutline-offset: 2px !important;\n}\n\n.acc-tooltip {\nposition: absolute;\nbackground: rgba(0, 0, 0, 0.9);\ncolor: white;\npadding: 8px 12px;\nborder-radius: 4px;\nfont-size: 12px;\npointer-events: none;\nz-index: 1000000;\nmax-width: 250px;\n}\n\n.acc-box-selector {\nposition: absolute;\nborder: 2px dashed #007cba;\nbackground: rgba(0, 123, 186, 0.1);\npointer-events: none;\nz-index: 999998;\n}\n\n.acc-minimized .acc-content {\ndisplay: none;\n}\n\n.acc-minimized {\nheight: auto;\n}\n',document.head.appendChild(e),document.body.appendChild(this.overlay),this.makeDraggable(),this.updatePalettesDisplay()}makeDraggable(){const t=this.overlay.querySelector(".acc-header");let e,n,o,a,r=!1,s=0,i=0;t.addEventListener("mousedown",t=>{"BUTTON"!==t.target.tagName&&(r=!0,o=t.clientX-s,a=t.clientY-i,t.preventDefault())}),document.addEventListener("mousemove",t=>{r&&(t.preventDefault(),e=t.clientX-o,n=t.clientY-a,s=e,i=n,this.overlay.style.transform=`translate(${e}px, ${n}px)`)}),document.addEventListener("mouseup",()=>{r=!1})}setupEventListeners(){this.overlay.querySelectorAll(".acc-tab").forEach(t=>{t.addEventListener("click",()=>this.switchTab(t.dataset.tab))}),this.overlay.querySelector("#acc-close").addEventListener("click",()=>this.hide()),this.overlay.querySelector("#acc-minimize").addEventListener("click",()=>this.toggleMinimize()),this.overlay.querySelector("#acc-fg-color").addEventListener("input",t=>{this.overlay.querySelector("#acc-fg-text").value=t.target.value,this.updateContrast()}),this.overlay.querySelector("#acc-bg-color").addEventListener("input",t=>{this.overlay.querySelector("#acc-bg-text").value=t.target.value,this.updateContrast()}),this.overlay.querySelector("#acc-fg-text").addEventListener("input",e=>{const n=t.parseColor(e.target.value);n&&(this.overlay.querySelector("#acc-fg-color").value=t.rgbToHex(n.r,n.g,n.b)),this.updateContrast()}),this.overlay.querySelector("#acc-bg-text").addEventListener("input",e=>{const n=t.parseColor(e.target.value);n&&(this.overlay.querySelector("#acc-bg-color").value=t.rgbToHex(n.r,n.g,n.b)),this.updateContrast()}),this.overlay.querySelector("#acc-color-format").addEventListener("change",t=>{this.currentColorFormat=t.target.value,this.updateColorInputs()}),this.overlay.querySelector("#acc-scan-all").addEventListener("click",()=>this.scanAllElements()),this.overlay.querySelector("#acc-hover-mode").addEventListener("click",()=>this.toggleHoverMode()),this.overlay.querySelector("#acc-box-select").addEventListener("click",()=>this.toggleBoxSelect()),this.overlay.querySelector("#acc-clear-highlights").addEventListener("click",()=>this.clearHighlights());const e=this.overlay.querySelector("#acc-text-adjust"),n=this.overlay.querySelector("#acc-bg-adjust"),o=this.overlay.querySelector("#acc-text-value"),a=this.overlay.querySelector("#acc-bg-value");e.addEventListener("input",t=>{o.textContent=t.target.value,this.updateContrast()}),n.addEventListener("input",t=>{a.textContent=t.target.value,this.updateContrast()}),this.overlay.querySelectorAll(".acc-filter").forEach(t=>{t.addEventListener("click",()=>this.filterIssues(t.dataset.filter))}),this.overlay.querySelector("#acc-save-palette").addEventListener("click",()=>this.savePalette()),this.overlay.querySelector("#acc-colorblind-sim").addEventListener("change",()=>this.updateContrast()),this.updateContrast()}setupMutationObserver(){this.observer=new MutationObserver(t=>{if(this.hoverMode)return;let e=!1;t.forEach(t=>{if("childList"===t.type&&t.addedNodes.length>0)for(let n of t.addedNodes)if(n.nodeType===Node.ELEMENT_NODE&&!n.closest("#acc-contrast-overlay")){e=!0;break}}),e&&this.debounce(()=>this.rescanNewElements(),500)()}),this.observer.observe(document.body,{childList:!0,subtree:!0})}debounce(t,e){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),t(...o)},e)}}switchTab(t){this.overlay.querySelectorAll(".acc-tab").forEach(e=>{e.classList.toggle("active",e.dataset.tab===t)}),this.overlay.querySelectorAll(".acc-tab-content").forEach(e=>{e.classList.toggle("active",e.id===`acc-${t}`)})}toggleMinimize(){this.overlay.classList.toggle("acc-minimized")}updateContrast(){const e=this.overlay.querySelector("#acc-fg-text").value,n=this.overlay.querySelector("#acc-bg-text").value,o=t.parseColor(e),a=t.parseColor(n);if(!o||!a)return;const r=parseInt(this.overlay.querySelector("#acc-text-adjust").value),s=parseInt(this.overlay.querySelector("#acc-bg-adjust").value),i=this.adjustBrightness(o,r),c=this.adjustBrightness(a,s),l=this.overlay.querySelector("#acc-colorblind-sim").value,d="none"!==l?t.simulateColorBlindness(i.r,i.g,i.b,l):i,h="none"!==l?t.simulateColorBlindness(c.r,c.g,c.b,l):c,u=t.getContrast(d,h);this.overlay.querySelector("#acc-contrast-ratio").textContent=`Contrast: ${u.toFixed(2)}:1`;let g="";g=u>=7?"‚úÖ WCAG AAA Pass":u>=4.5?"‚úÖ WCAG AA Pass":u>=3?"‚ö†Ô∏è Large Text Only":"‚ùå WCAG Fail",this.overlay.querySelector("#acc-wcag-status").textContent=g,this.updateColorInputs()}adjustBrightness(t,e){const n=e/100;return{r:Math.max(0,Math.min(255,Math.round(t.r+n*(n>0?255-t.r:t.r)))),g:Math.max(0,Math.min(255,Math.round(t.g+n*(n>0?255-t.g:t.g)))),b:Math.max(0,Math.min(255,Math.round(t.b+n*(n>0?255-t.b:t.b))))}}updateColorInputs(){const e=t.parseColor(this.overlay.querySelector("#acc-fg-color").value),n=t.parseColor(this.overlay.querySelector("#acc-bg-color").value);if(!e||!n)return;const o=this.currentColorFormat;if("rgb"===o)this.overlay.querySelector("#acc-fg-text").value=`rgb(${e.r}, ${e.g}, ${e.b})`,this.overlay.querySelector("#acc-bg-text").value=`rgb(${n.r}, ${n.g}, ${n.b})`;else if("hsl"===o){const o=t.rgbToHsl(e.r,e.g,e.b),a=t.rgbToHsl(n.r,n.g,n.b);this.overlay.querySelector("#acc-fg-text").value=`hsl(${Math.round(o.h)}, ${Math.round(o.s)}%, ${Math.round(o.l)}%)`,this.overlay.querySelector("#acc-bg-text").value=`hsl(${Math.round(a.h)}, ${Math.round(a.s)}%, ${Math.round(a.l)}%)`}else if("hsv"===o){const o=t.rgbToHsv(e.r,e.g,e.b),a=t.rgbToHsv(n.r,n.g,n.b);this.overlay.querySelector("#acc-fg-text").value=`hsv(${Math.round(o.h)}, ${Math.round(o.s)}%, ${Math.round(o.v)}%)`,this.overlay.querySelector("#acc-bg-text").value=`hsv(${Math.round(a.h)}, ${Math.round(a.s)}%, ${Math.round(a.v)}%)`}else this.overlay.querySelector("#acc-fg-text").value=t.rgbToHex(e.r,e.g,e.b),this.overlay.querySelector("#acc-bg-text").value=t.rgbToHex(n.r,n.g,n.b)}scanAllElements(){this.clearHighlights(),this.issues=[];const t=document.querySelectorAll("*:not(script):not(style):not(noscript):not(#acc-contrast-overlay):not(#acc-contrast-overlay *)");const e=t.length;let n=0;const o=()=>{const a=Math.min(n+50,e);for(let e=n;e<a;e++)this.analyzeElement(t[e]);n=a,n<e?setTimeout(o,0):(this.updateResultsTab(),this.switchTab("results"))};o()}analyzeElement(e){try{const n=window.getComputedStyle(e),o=this.getEffectiveTextColor(e),a=this.getEffectiveBackgroundColor(e);if(!o||!a)return;const r=e.textContent&&e.textContent.trim().length>0;if(!("0"!==n.opacity&&"hidden"!==n.visibility&&"none"!==n.display))return;const s=t.getContrast(o,a),i=parseFloat(n.fontSize),c=n.fontWeight,l=i>=24||i>=18&&("bold"===c||parseInt(c)>=700),d=l?3:4.5,h=s>=d,u=this.isNonTextElement(e),g=!u||s>=3;r&&!h?(this.issues.push({element:e,type:"1.4.3",contrast:s.toFixed(2),required:d,passes:!1,textColor:o,bgColor:a,isLargeText:l,selector:this.getSelector(e)}),e.classList.add("acc-highlight-fail"),this.highlightedElements.push(e)):r&&h&&(e.classList.add("acc-highlight-pass"),this.highlightedElements.push(e)),u&&!g&&(this.issues.push({element:e,type:"1.4.11",contrast:s.toFixed(2),required:3,passes:!1,textColor:o,bgColor:a,selector:this.getSelector(e)}),e.classList.contains("acc-highlight-fail")||(e.classList.add("acc-highlight-fail"),this.highlightedElements.push(e)))}catch(t){console.warn("Error analyzing element:",e,t)}}getEffectiveTextColor(e){try{const n=window.getComputedStyle(e).color;return n&&"rgba(0, 0, 0, 0)"!==n&&"transparent"!==n?t.parseColor(n):null}catch(t){return null}}getEffectiveBackgroundColor(e){let n=e,o=0;for(;n&&n!==document.documentElement&&o<10;)try{const e=window.getComputedStyle(n).backgroundColor;if(e&&"rgba(0, 0, 0, 0)"!==e&&"transparent"!==e){const n=t.parseColor(e);if(n&&n.a>0)return n}n=n.parentElement,o++}catch(t){break}return{r:255,g:255,b:255,a:1}}isNonTextElement(t){const e=t.tagName.toLowerCase(),n=t.getAttribute("role");return["button","input","select","textarea"].includes(e)||["button","link","tab","menuitem"].includes(n)||t.hasAttribute("tabindex")||null!==t.onclick}getSelector(t){try{if(t.id)return`#${t.id}`;let e=t.tagName.toLowerCase();if(t.className&&"string"==typeof t.className){const n=t.className.split(" ").filter(t=>t&&!t.startsWith("acc-")).slice(0,3);n.length>0&&(e+="."+n.join("."))}if(t.parentElement){const n=Array.from(t.parentElement.children).filter(e=>e.tagName===t.tagName);if(n.length>1){e+=`:nth-of-type(${n.indexOf(t)+1})`}}return e.length>100&&(e=e.substring(0,97)+"..."),e}catch(e){return t.tagName.toLowerCase()}}toggleHoverMode(){this.hoverMode=!this.hoverMode;this.overlay.querySelector("#acc-hover-mode").classList.toggle("active",this.hoverMode),this.hoverMode?(this.setupHoverListeners(),document.body.style.cursor="crosshair"):(this.removeHoverListeners(),this.hideTooltip(),document.body.style.cursor="")}setupHoverListeners(){this.hoverHandler=e=>{if(e.target.closest("#acc-contrast-overlay"))return;const n=e.target,o=this.getEffectiveTextColor(n),a=this.getEffectiveBackgroundColor(n);if(o&&a){const r=t.getContrast(o,a);this.showTooltip(e,{textColor:t.rgbToHex(o.r,o.g,o.b),bgColor:t.rgbToHex(a.r,a.g,a.b),contrast:r.toFixed(2),element:this.getSelector(n)}),this.overlay.querySelector("#acc-fg-color").value=t.rgbToHex(o.r,o.g,o.b),this.overlay.querySelector("#acc-fg-text").value=t.rgbToHex(o.r,o.g,o.b),this.overlay.querySelector("#acc-bg-color").value=t.rgbToHex(a.r,a.g,a.b),this.overlay.querySelector("#acc-bg-text").value=t.rgbToHex(a.r,a.g,a.b),this.updateContrast()}},this.mouseLeaveHandler=()=>{this.hideTooltip()},document.addEventListener("mouseover",this.hoverHandler),document.addEventListener("mouseleave",this.mouseLeaveHandler)}removeHoverListeners(){this.hoverHandler&&(document.removeEventListener("mouseover",this.hoverHandler),document.removeEventListener("mouseleave",this.mouseLeaveHandler),this.hoverHandler=null,this.mouseLeaveHandler=null)}showTooltip(t,e){this.tooltip||(this.tooltip=document.createElement("div"),this.tooltip.className="acc-tooltip",document.body.appendChild(this.tooltip)),this.tooltip.innerHTML=`\n<div><strong>${e.element}</strong></div>\n<div>Text: ${e.textColor}</div>\n<div>Background: ${e.bgColor}</div>\n<div>Contrast: ${e.contrast}:1</div>\n`,this.tooltip.style.display="block";const n=this.tooltip.getBoundingClientRect();let o=t.pageX+10,a=t.pageY-10;o+n.width>window.innerWidth&&(o=t.pageX-n.width-10),a+n.height>window.innerHeight&&(a=t.pageY-n.height+10),this.tooltip.style.left=o+"px",this.tooltip.style.top=a+"px"}hideTooltip(){this.tooltip&&(this.tooltip.style.display="none")}toggleBoxSelect(){this.boxSelectMode=!this.boxSelectMode;this.overlay.querySelector("#acc-box-select").classList.toggle("active",this.boxSelectMode),this.boxSelectMode?(this.setupBoxSelectListeners(),document.body.style.cursor="crosshair"):(this.removeBoxSelectListeners(),document.body.style.cursor="",this.removeBoxSelector())}setupBoxSelectListeners(){this.boxStartHandler=t=>{t.target.closest("#acc-contrast-overlay")||(this.isSelecting=!0,this.startX=t.pageX,this.startY=t.pageY,this.createBoxSelector(),t.preventDefault())},this.boxMoveHandler=t=>{if(!this.isSelecting)return;const e=t.pageX,n=t.pageY,o=Math.min(this.startX,e),a=Math.min(this.startY,n),r=Math.abs(e-this.startX),s=Math.abs(n-this.startY);this.updateBoxSelector(o,a,r,s)},this.boxEndHandler=t=>{if(!this.isSelecting)return;this.isSelecting=!1;const e=this.boxSelector.getBoundingClientRect();this.analyzeElementsInBox(e),this.removeBoxSelector(),this.toggleBoxSelect()},document.addEventListener("mousedown",this.boxStartHandler),document.addEventListener("mousemove",this.boxMoveHandler),document.addEventListener("mouseup",this.boxEndHandler)}removeBoxSelectListeners(){this.boxStartHandler&&(document.removeEventListener("mousedown",this.boxStartHandler),document.removeEventListener("mousemove",this.boxMoveHandler),document.removeEventListener("mouseup",this.boxEndHandler),this.boxStartHandler=null,this.boxMoveHandler=null,this.boxEndHandler=null)}createBoxSelector(){this.removeBoxSelector(),this.boxSelector=document.createElement("div"),this.boxSelector.className="acc-box-selector",document.body.appendChild(this.boxSelector)}updateBoxSelector(t,e,n,o){this.boxSelector&&(this.boxSelector.style.left=t+"px",this.boxSelector.style.top=e+"px",this.boxSelector.style.width=n+"px",this.boxSelector.style.height=o+"px")}removeBoxSelector(){this.boxSelector&&(this.boxSelector.remove(),this.boxSelector=null)}analyzeElementsInBox(t){this.clearHighlights(),this.issues=[];document.querySelectorAll("*:not(script):not(style):not(noscript):not(#acc-contrast-overlay):not(#acc-contrast-overlay *)").forEach(e=>{try{const n=e.getBoundingClientRect();this.rectsIntersect(t,n)&&this.analyzeElement(e)}catch(t){}}),this.updateResultsTab(),this.switchTab("results")}rectsIntersect(t,e){return!(t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom)}clearHighlights(){this.highlightedElements.forEach(t=>{try{t.classList.remove("acc-highlight-pass","acc-highlight-fail")}catch(t){}}),this.highlightedElements=[]}rescanNewElements(){document.querySelectorAll("*:not(script):not(style):not(noscript):not(#acc-contrast-overlay):not(#acc-contrast-overlay *)").forEach(t=>{t.classList.contains("acc-highlight-pass")||t.classList.contains("acc-highlight-fail")||this.analyzeElement(t)}),this.updateResultsTab()}updateResultsTab(){const e=this.overlay.querySelector("#acc-issues-list");0!==this.issues.length?e.innerHTML=this.issues.map((e,n)=>`\n<div class="acc-issue-item" data-type="${e.type}" onclick="window.accessibilityContrastChecker.scrollToElement(${n})">\n<div class="acc-issue-header">\n${"1.4.3"===e.type?"üìù Text Contrast":"üé® Non-text Contrast"} - ${e.contrast}:1\n</div>\n<div class="acc-issue-details">\nRequired: ${e.required}:1 | Element: ${e.selector}\n<br>Text: ${t.rgbToHex(e.textColor.r,e.textColor.g,e.textColor.b)} | \nBackground: ${t.rgbToHex(e.bgColor.r,e.bgColor.g,e.bgColor.b)}\n<br>\n<button onclick="window.accessibilityContrastChecker.copySelector('${e.selector.replace(/'/g,"\\'")}'); event.stopPropagation();">Copy Selector</button>\n<button onclick="window.accessibilityContrastChecker.suggestColors(${e.textColor.r}, ${e.textColor.g}, ${e.textColor.b}, ${e.bgColor.r}, ${e.bgColor.g}, ${e.bgColor.b}); event.stopPropagation();">Suggest Fix</button>\n</div>\n</div>\n`).join(""):e.innerHTML='<div style="text-align: center; color: #28a745; padding: 20px;">‚úÖ No accessibility issues found!</div>'}scrollToElement(t){const e=this.issues[t];if(e&&e.element&&document.contains(e.element)){e.element.scrollIntoView({behavior:"smooth",block:"center"});const t=e.element.style.outline;e.element.style.outline="4px solid #ff6b6b",e.element.style.outlineOffset="2px",setTimeout(()=>{e.element.style.outline=t,e.element.style.outlineOffset=""},2e3)}}copySelector(t){navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>{const t=event.target,e=t.textContent;t.textContent="Copied!",t.style.background="#28a745",t.style.color="white",setTimeout(()=>{t.textContent=e,t.style.background="",t.style.color=""},1e3)}).catch(()=>{this.fallbackCopyTextToClipboard(t)}):this.fallbackCopyTextToClipboard(t)}fallbackCopyTextToClipboard(t){const e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy");const t=event.target,e=t.textContent;t.textContent="Copied!",setTimeout(()=>{t.textContent=e},1e3)}catch(t){console.error("Could not copy text: ",t)}document.body.removeChild(e)}suggestColors(e,n,o,a,r,s){const i={r:e,g:n,b:o},c={r:a,g:r,b:s},l=[];for(let e=10;e<=90;e+=10){const n=this.adjustBrightness(c,e),o=t.getContrast(i,n);if(o>=4.5){l.push({type:"Background lighter",bg:t.rgbToHex(n.r,n.g,n.b),fg:t.rgbToHex(i.r,i.g,i.b),contrast:o.toFixed(2)});break}}for(let e=-10;e>=-90;e-=10){const n=this.adjustBrightness(c,e),o=t.getContrast(i,n);if(o>=4.5){l.push({type:"Background darker",bg:t.rgbToHex(n.r,n.g,n.b),fg:t.rgbToHex(i.r,i.g,i.b),contrast:o.toFixed(2)});break}}for(let e=10;e<=90;e+=10){const n=this.adjustBrightness(i,e),o=t.getContrast(n,c);if(o>=4.5){l.push({type:"Text lighter",bg:t.rgbToHex(c.r,c.g,c.b),fg:t.rgbToHex(n.r,n.g,n.b),contrast:o.toFixed(2)});break}}for(let e=-10;e>=-90;e-=10){const n=this.adjustBrightness(i,e),o=t.getContrast(n,c);if(o>=4.5){l.push({type:"Text darker",bg:t.rgbToHex(c.r,c.g,c.b),fg:t.rgbToHex(n.r,n.g,n.b),contrast:o.toFixed(2)});break}}if(l.length>0){const t=l[0],e=`Suggestion: ${t.type}\nForeground: ${t.fg}\nBackground: ${t.bg}\nContrast: ${t.contrast}:1\n\nApply this suggestion to the color picker?`;confirm(e)&&(this.overlay.querySelector("#acc-fg-color").value=t.fg,this.overlay.querySelector("#acc-fg-text").value=t.fg,this.overlay.querySelector("#acc-bg-color").value=t.bg,this.overlay.querySelector("#acc-bg-text").value=t.bg,this.updateContrast(),this.switchTab("checker"))}else alert("No simple color adjustments found. Try using high contrast colors like black on white.")}filterIssues(t){this.overlay.querySelectorAll(".acc-filter").forEach(e=>{e.classList.toggle("active",e.dataset.filter===t)});this.overlay.querySelectorAll(".acc-issue-item").forEach(e=>{const n=e.dataset.type;e.style.display="all"===t||t===n?"block":"none"})}savePalette(){const t=this.overlay.querySelector("#acc-palette-name").value.trim();if(!t)return void alert("Please enter a palette name");const e=this.overlay.querySelector("#acc-fg-text").value,n=this.overlay.querySelector("#acc-bg-text").value;this.colorPalettes[t]={fg:e,bg:n},this.savePalettes(),this.updatePalettesDisplay(),this.overlay.querySelector("#acc-palette-name").value=""}updatePalettesDisplay(){const t=this.overlay.querySelector("#acc-saved-palettes");0!==Object.keys(this.colorPalettes).length?t.innerHTML=Object.entries(this.colorPalettes).map(([t,e])=>`\n<div class="acc-palette-item">\n<div>\n<strong>${t}</strong>\n<div class="acc-palette-colors">\n<div class="acc-palette-color" style="background-color: ${e.fg}" title="Foreground: ${e.fg}"></div>\n<div class="acc-palette-color" style="background-color: ${e.bg}" title="Background: ${e.bg}"></div>\n</div>\n</div>\n<div>\n<button onclick="window.accessibilityContrastChecker.loadPalette('${t.replace(/'/g,"\\'")}')">Load</button>\n<button onclick="window.accessibilityContrastChecker.deletePalette('${t.replace(/'/g,"\\'")}')">Delete</button>\n</div>\n</div>\n`).join(""):t.innerHTML='<div style="text-align: center; color: #666; padding: 10px; font-style: italic;">No saved palettes</div>'}loadPalette(t){const e=this.colorPalettes[t];e&&(this.overlay.querySelector("#acc-fg-color").value=e.fg,this.overlay.querySelector("#acc-fg-text").value=e.fg,this.overlay.querySelector("#acc-bg-color").value=e.bg,this.overlay.querySelector("#acc-bg-text").value=e.bg,this.updateContrast())}deletePalette(t){confirm(`Delete palette "${t}"?`)&&(delete this.colorPalettes[t],this.updatePalettesDisplay())}show(){this.overlay.style.display="block",this.isVisible=!0}hide(){this.overlay.style.display="none",this.isVisible=!1,this.clearHighlights(),this.removeHoverListeners(),this.removeBoxSelectListeners(),this.hideTooltip(),document.body.style.cursor="",this.observer&&this.observer.disconnect()}toggle(){this.isVisible?this.hide():this.show()}},window.accessibilityContrastChecker.show()}();
